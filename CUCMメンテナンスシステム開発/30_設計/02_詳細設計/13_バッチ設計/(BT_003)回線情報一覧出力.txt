局面						詳細設計								クライアント名／プロジェクト名																						SMBC日興/IP電話EOL																																		頁															
機能名														回線情報一覧出力																																								作成日								2023/04/01								作成者							内藤								
バッチID／バッチ名														BT_003																																								更新日																更新者															
																																																																													目次へ								
【詳細仕様】																																																																																					
																																																																																					
	【処理イメージ】																																																																																				
																																																																																					
																																																																																					
																																																																																					
																																																																																					
																																																																																					
																																																																																					
																																																																																					
																																																																																					
																																																																																					
																																																																																					
																																																																																					
																																																																																					
																																																																																					
	【ファイルI/O】																																																																																				
		分類												ファイル名																							I/O					備考																																											
		回線情報一覧												EXPORT_LINELIST_EXPORTED_YYYYMMDDHH24MISS.csv																							OUTPUT																																																
																																																																																					
	【処理詳細】																																																																																				
																																																																																					
		■初期処理																																																																																			
			1.ロックファイル作成																																																																																		
				①ロック中かチェックする																																																																																	
					▼ロック中の場合																																																																																
						・以下のメッセージIDでログを出力する																																																																															
							メッセージID：BT_000_E001																																																																														
						・「BatRuntimeException」例外を発生させる																																																																															
																																																																																					
				②[バッチ詳細設計共通].ロックファイル作成処理を呼出し、バッチ処理の実行中とする																																																																																	
																																																																																					
			2.設定情報保持																																																																																		
				設定ファイルから以下の設定を取得し保持する																																																																																	
					設定項目名												説明																			保持方法																																																	
					LineListCsvHeader												回線情報一覧CSVのヘッダ定義																			変数A																																																	
					CsvExportLineList												回線情報一覧CSVファイル名																			変数B																																																	
					OutputDir												出力先ベースディレクトリ																			変数C																																																	
					LinelistOutputDir												回線情報一覧CSV出力先ディレクトリ																			変数D																																																	
																																																																																					
		■回線情報一覧出力処理																																																																																			
			1.データ取得																																																																																		
				①回線情報一覧のエクスポート用の値を取得する																																																																																	
					テーブル名																		取得項目																																条件																														
					②取得結果																		COALESCE(statusName,'')																																無し																														
																							, COALESCE(directoryNumber,'')																																																														
																							, COALESCE(telType,'')																																																														
																							, COALESCE(dialinNumber,'')																																																														
																							, COALESCE(lineIndex,'')																																																														
																							, COALESCE(kanjiUserName,'')																																																														
																							, COALESCE(sectionUserName,'')																																																														
																							, COALESCE(pickupGroupName,'')																																																														
																							, COALESCE(voiceMailProfileName,'')																																																														
																							, COALESCE(busyDestination,'')																																																														
																							, COALESCE(chargeAssociationBranchId,'')																																																														
																							, COALESCE(chargeAssociationParentSectionId,'')																																																														
																							, COALESCE(chargeAssociationSectionId,'')																																																														
																							, COALESCE(chargeRemarks,'')																																																														
																							, COALESCE(loggerDataName,'')																																																														
																							, COALESCE(telTypeModel,'')																																																														
																							, COALESCE(macAddress,'')																																																														
																							, COALESCE(phoneButtonTemplete,'')																																																														
																							, COALESCE(branchTelName,'')																																																														
																							, COALESCE(sectionTelName,'')																																																														
																							, COALESCE(callingSearchSpaceName,'')																																																														
																							, COALESCE(addonModuleName1,'')																																																														
																							, COALESCE(addonModuleName2,'')																																																														
																							, COALESCE(ringSettingName,'')																																																														
																							, COALESCE(telLineRemarks,'')																																																														
																							, COALESCE(lineTextLabel,'')																																																														
																							, COALESCE(noansDestination,'')																																																														
																							, COALESCE(externalPhoneNumberMask,'')																																																														
																							, COALESCE(telRemarks,'')																																																														
																							, COALESCE(transMask)																																																														
																							, COALESCE(gwRepletionSpecialNo)	
													
				②ユーザー一覧を取得する																																																																																	
					テーブル名																		取得項目																																条件																														
					⑦取得結果																		⑦取得結果.lineId																																無し																														
					LEFT OUTER JOIN ③取得結果																		, ⑦取得結果.lineIndex																																																														
					  ON ⑦取得結果.telId																		, ⑦取得結果.pickupGroupName																																																														
					    = ③取得結果.telId																		, ⑦取得結果.directoryNumber																																																														
					LEFT OUTER JOIN ④取得結果																		, ⑦取得結果.busyDestination																																																														
					  ON ⑦取得結果.lineId																		, ⑦取得結果.noansDestination																																																														
					   =④取得結果.lineId																		, ⑦取得結果.loggerData																																																														
					LEFT OUTER JOIN ⑤取得結果																		, ⑦取得結果.chargeAssociationBranchId																																																														
					  ON ⑦取得結果.userId																		, ⑦取得結果.chargeAssociationParentSectionId																																																														
					    =  ⑤取得結果.userId																		, ⑦取得結果.chargeAssociationSectionId																																																														
					LEFT OUTER JOIN ⑥取得結果																		, ⑦取得結果.lineTextLabel																																																														
					  ON ⑦取得結果.telId																		, ⑦取得結果.externalPhoneNumberMask																																																														
					    = ⑥取得結果.telId																		, ⑦取得結果.dialinNumber																																																														
																							, ⑦取得結果.userId																																																														
																							, ⑦取得結果.kanjiUserName																																																														
																							, ⑦取得結果.kanaUserName																																																														
																							, ⑦取得結果.companyUserId																																																														
																							, ⑦取得結果.sectionUserId																																																														
																							, ⑦取得結果.sectionUserName																																																														
																							, ⑦取得結果.sharedUse																																																														
																							, ⑦取得結果.telId																																																														
																							, ⑦取得結果.telTypeModel																																																														
																							, ⑦取得結果.telType																																																														
																							, ⑦取得結果.macAddress																																																														
																							, ⑦取得結果.callingSearchSpaceName																																																														
																							, ⑦取得結果.branchTelId																																																														
																							, ⑦取得結果.companyTelId																																																														
																							, ⑦取得結果.sectionTelId																																																														
																							, ⑦取得結果.phoneButtonTemplete																																																														
																							, ⑦取得結果.branchTelName																																																														
																							, ⑦取得結果.sectionTelName																																																														
																							, ⑦取得結果.statusCode																																																														
																							, ⑦取得結果.statusName																																																														
																							, ⑦取得結果.voiceMailProfileName																																																														
																							, ⑦取得結果.telLineRemarks																																																														
																							, ⑦取得結果.telRemarks																																																														
																							, ⑦取得結果.chargeRemarks																																																														
																							, ⑦取得結果.addonModuleName1																																																														
																							, ⑦取得結果.addonModuleName2																																																														
																							, ⑦取得結果.ringSettingName																																																														
																							, ⑦取得結果.pickupGroupNo																																																														
																							, ⑦取得結果.loggerDataName																																																														
																							, ⑦取得結果.transMask																																																														
																							, ⑦取得結果.gwRepletionSpecialNo																																																														
																							, ROW_NUMBER() OVER (ORDER BY ( ${DEFAULT_SORT} )) AS row_number																																																														
																							, COALESCE(③取得結果.status, '0') AS jointuse																																																														
																							, CASE																																																														
																							  WHEN																																																														
																							    COALESCE(③取得結果.status, '9') = '0'																																																														
																							    AND COALESCE(⑤取得結果.status, '9') = '0'																																																														
																							    AND COALESCE(④取得結果.status, '9') = '0'																																																														
																							    AND COALESCE(⑥取得結果.status, '9') = '0'																																																														
																							    AND COALESCE(⑦取得結果.sharedUse, '0') = '0'																																																														
																							  THEN '1'																																																														
																							  WHEN																																																														
																							    COALESCE(③取得結果.status, '9') = '1'																																																														
																							    AND COALESCE(⑤取得結果.status, '9')  '0'																																																														
																							    AND COALESCE(④取得結果.status, '9') = '0'																																																														
																							    AND COALESCE(⑥取得結果.status, '9') = '0'																																																														
																							    AND COALESCE(⑦取得結果.sharedUse, '0') = '0'																																																														
																							  THEN '2'																																																														
																							  WHEN																																																														
																							    COALESCE(③取得結果.status, '9') IN ('0','9')																																																														
																							    AND COALESCE(⑤取得結果.status, '9') IN ('0','9')																																																														
																							    AND COALESCE(④取得結果.status, '9') = '1'																																																														
																							    AND COALESCE(⑥取得結果.status, '9') = '0'																																																														
																							    AND COALESCE(⑦取得結果.sharedUse, '0') = '0'																																																														
																							  THEN '3'																																																														
																							  WHEN																																																														
																							    COALESCE(③取得結果.status, '9') = '0'																																																														
																							    AND COALESCE(⑤取得結果.status, '9') = '1'																																																														
																							    AND COALESCE(④取得結果.status, '9') = '0'																																																														
																							    AND COALESCE(⑥取得結果.status, '9') = '0'																																																														
																							    AND COALESCE(⑦取得結果.sharedUse, '0') = '0'																																																														
																							  THEN '4'																																																														
																							  WHEN																																																														
																							    COALESCE(③取得結果.status, '9') IN ('0','9')																																																														
																							    AND COALESCE(⑤取得結果.status, '9') IN ('0','9')																																																														
																							    AND COALESCE(④取得結果.status, '9') = '0'																																																														
																							    AND COALESCE(⑥取得結果.status, '9') = '1'																																																														
																							    AND COALESCE(⑦取得結果.sharedUse, '0') = '0'																																																														
																							  THEN '5'																																																														
																							  WHEN																																																														
																							    COALESCE(③取得結果.status, '9') = '0'																																																														
																							    AND COALESCE(⑤取得結果.status, '9') = '0'																																																														
																							    AND COALESCE(④取得結果.status, '9') = '0'																																																														
																							    AND COALESCE(⑥取得結果.status, '9') = '0'																																																														
																							    AND COALESCE(⑦取得結果.sharedUse, '0') = '1'																																																														
																							  THEN '6'																																																														
																							  WHEN																																																														
																							    COALESCE(⑥取得結果.status, '9')= '9'																																																														
																							  THEN '7'																																																														
																							  WHEN																																																														
																							    COALESCE(③取得結果.status, '9') = '9'																																																														
																							    AND COALESCE(⑤取得結果.status, '9') = '9'																																																														
																							    AND COALESCE(④取得結果.status, '9') = '0'																																																														
																							    AND COALESCE(⑥取得結果.status, '9') = '0'																																																														
																							    AND COALESCE(⑦取得結果.sharedUse, '0') = '0'																																																														
																							  THEN '8'																																																														
																							  ELSE '9'																																																														
																							END AS telUsagesStatus																																																														
				③ユーザー電話情報																																																																																	
					テーブル名																		取得項目																																条件																集計														
					rel_cucm_user_phone																		phone_id																																delete_flg = '0'																phone_id														
																																																																																					
				④電話LINE紐付（Line）情報																																																																																	
					テーブル名																		取得項目																																条件																集計														
					rel_cucm_phone_line																		line_id,																																delete_flg = '0'																line_id														
																							CASE																																																														
																							  WHEN count(line_id) <![CDATA[<=]]> 1 THEN '0'																																																														
																							  ELSE '1'																																																														
																							END AS status																																																														
																																																																																					
				⑤ユーザ電話紐付																																																																																	
					テーブル名																		取得項目																																条件																集計														
					rel_cucm_user_phone																		user_id,																																delete_flg = '0'																user_id														
																							CASE																																																														
																							  WHEN count(user_id) <![CDATA[<=]]> 1 THEN '0'																																																														
																							  ELSE '1'																																																														
																							END AS status																																																														
																																																																																					
				⑥電話LINE紐付（電話）情報																																																																																	
					テーブル名																		取得項目																																条件																集計														
					rel_cucm_phone_line																		phone_id,																																delete_flg = '0'																phone_id														
																							CASE																																																														
																							  WHEN count(phone_id) <![CDATA[<=]]> 1 THEN '0'																																																														
																							  ELSE '1'																																																														
																							END AS status																																																														
																																																																																					
				⑦ユーザーと電話機一覧を取得する																																																																																	
					テーブル名																		取得項目																																条件																														
					⑧取得結果																		lineId																																無し																														
					UNION ALL																		, lineIndex																																																														
					⑪取得結果																		, COALESCE(pickupGroupName,'')																																																														
																							, COALESCE(directoryNumber,'')																																																														
																							, COALESCE(busyDestination,'')																																																														
																							, COALESCE(noansDestination,'')																																																														
																							, loggerData																																																														
																							, COALESCE(chargeAssociationBranchId,'')																																																														
																							, COALESCE(chargeAssociationParentSectionId,'')																																																														
																							, COALESCE(chargeAssociationSectionId,'')																																																														
																							, COALESCE(lineTextLabel,'')																																																														
																							, COALESCE(externalPhoneNumberMask,'')																																																														
																							, COALESCE(dialinNumber,'')																																																														
																							, userId																																																														
																							, kanjiUserName																																																														
																							, kanaUserName																																																														
																							, companyUserId																																																														
																							, sectionUserId																																																														
																							, userSectionparentPrintorder																																																														
																							, userSectionchildPrintorder																																																														
																							, userSectionPrintorder																																																														
																							, userBranchAll																																																														
																							, userBranch																																																														
																							, sectionUserName																																																														
																							, sharedUse																																																														
																							, telId																																																														
																							, telTypeModel																																																														
																							, telType																																																														
																							, macAddress																																																														
																							, COALESCE(callingSearchSpaceName,'')																																																														
																							, COALESCE(baseLocation,'')																																																														
																							, COALESCE(baseDp,'')																																																														
																							, branchTelId																																																														
																							, companyTelId																																																														
																							, sectionTelId																																																														
																							, phoneButtonTemplete																																																														
																							, branchTelName																																																														
																							, sectionTelName																																																														
																							, phoneSectionParentPrintorder																																																														
																							, phoneSectionChildPrintorder																																																														
																							, searchSectionName																																																														
																							, orgId																																																														
																							, COALESCE(statusCode,'')																																																														
																							, COALESCE(status,'')																																																														
																							, clusterId																																																														
																							, voiceMailProfileName																																																														
																							, telLineRemarks																																																														
																							, telRemarks																																																														
																							, chargeRemarks																																																														
																							, COALESCE(addonModuleName1,'')																																																														
																							, COALESCE(addonModuleName2,'')																																																														
																							, COALESCE(ringSettingName,'')																																																														
																							, COALESCE(pickupGroupNo,'')																																																														
																							, COALESCE(loggerDataName,'')																																																														
																							, COALESCE(transMask,'')																																																														
																							, COALESCE(gwRepletionSpecialNo,'')																																																														

				⑧電話機情報																																																																																	
					テーブル名																								取得項目																																			条件																					
					trn_phone																								⑨取得結果.lineId																																			trn_phone.delete_flg = '0'																					
					INNER JOIN ⑨取得結果																								, ⑨取得結果.lineIndex																																																								
					  on trn_phone.phone_id																								, ⑨取得結果.pickupGroupName																																																								
					   = ⑨取得結果.cucmtelidinline																								, ⑨取得結果.directoryNumber																																																								
					LEFT OUTER JOIN ⑩取得結果																								, ⑨取得結果.busyDestination																																																								
					  on trn_phone.phone_id																								, ⑨取得結果.noansDestination																																																								
					   = ⑩取得結果.cucmtelidinuser																								, NULL AS loggerData																																																								
					LEFT OUTER JOIN trn_cuc_association																								, ⑨取得結果.chargeAssociationBranchId																																																								
					  ON trn_phone.phone_id																								, ⑨取得結果.chargeAssociationParentSectionId																																																								
					    = trn_cuc_association.phone_id																								, ⑨取得結果.chargeAssociationSectionId																																																								
					INNER JOIN mst_branch																								, ⑨取得結果.lineTextLabel																																																								
					  ON trn_phone.branch_id																								, ⑨取得結果.externalPhoneNumberMask																																																								
					    = mst_branch.branch_id																								, ⑨取得結果.dialinNumber																																																								
					INNER JOIN mst_section t_section_child																								, NULL AS telDirData																																																								
					  ON trn_phone.section_id																								, ⑩取得結果.userId																																																								
					    = t_section_child.section_id																								, ⑩取得結果.kanjiUserName																																																								
					INNER JOIN mst_section t_section_parent																								, ⑩取得結果.kanaUserName																																																								
					  ON t_section_child.parent_section_id																								, ⑩取得結果.companyId																																																								
					    = t_section_parent.section_id																								, ⑩取得結果.sectionId																																																								
					LEFT OUTER JOIN mst_cucm_pickup_group																								, ⑩取得結果.parentPrintorder																																																								
					  ON ⑨取得結果.pickupgroupname																								, ⑩取得結果.childPrintorder																																																								
					    = mst_cucm_pickup_group.pickup_group_nm																								, ⑩取得結果.userSectionPrintorder																																																								
					INNER JOIN mst_cucm_device_type																								, NULL AS userBranchAll																																																								
					  ON trn_phone.device_type_id																								, NULL AS userBranch																																																								
					    = mst_cucm_device_type.device_type_id																								, ⑩取得結果.sectionName																																																								
					INNER JOIN mst_cucm_calling_search_space																								, ⑩取得結果.sharedUse																																																								
					  ON trn_phone.calling_search_space_id																								, mst_cucm_device_type.device_type_nm AS telTypeModel																																																								
					    = mst_cucm_calling_search_space.calling_search_space_id																								, SUBSTRING(trn_phone.device_nm,1,3) AS telType																																																								
					INNER JOIN mst_cucm_location																								, SUBSTRING(trn_phone.device_nm,4) AS macAddress																																																								
					  ON trn_phone.location_id																								, mst_cucm_calling_search_space.calling_search_space_nm  AS callingSearchSpaceName																																																								
					    = mst_cucm_location.location_id																								, mst_cucm_location.location_nm              AS baseLocation																																																								
					INNER JOIN mst_cucm_device_pool																								, mst_cucm_device_pool.device_pool_nm           AS baseDp																																																								
					  ON trn_phonedevice_pool_id																								, trn_phone.branch_id                  AS branchTelId																																																								
					    = mst_cucm_device_pool.device_pool_id																								, t_section_child.company_cd                 AS companyTelId																																																								
					INNER JOIN mst_cucm_phone_template																								, trn_phone.section_id                 AS sectionTelId																																																								
					  ON trn_phone.phone_template_id																								, mst_cucm_phone_template.phone_template_nm AS phoneButtonTemplete																																																								
					    = mst_cucm_phone_template.phone_template_id																								, mst_branch.branch_nm                  AS branchTelName																																																								
																													, t_section_child.section_nm          AS sectionTelName																																																								
																													, t_section_child.print_order           AS phoneSectionChildPrintorder																																																								
																													, t_section_parent.print_order          AS phoneSectionParentPrintorder																																																								
																													, SUBSTRING(⑩取得結果.sectionName,																																																								
																													  length(⑩取得結果.childSectionName) + 1) AS searchSectionName																																																								
																													, ength(⑩取得結果.childSectionName) + 1)																																																								
																													, t_section_child.organization_cd AS orgId																																																								
																													, NULL AS clusterId																																																								
																													, ⑨取得結果.voiceMailProfileName																																																								
																													, ⑨取得結果.telLineRemarks																																																								
																													, ⑨取得結果.telRemarks																																																								
																													, ⑨取得結果.chargeRemarks																																																								
																													, COALESCE(trn_phone.addon_module_nm_1,'')																																																								
																													, trn_phone.addon_module_nm_2																																																								
																													, ⑨取得結果.ringSettingName																																																								
																													, mst_cucm_pickup_group.pickup_group_nm AS pickupGroupNo																																																								
																													, NULL AS loggerDataName																																																								
																													, CASE																																																								
																													  WHEN																																																								
																													    trn_phone.cucm_update_request_flg = '2'																																																								
																													  THEN '2'																																																								
																													  WHEN																																																								
																													   trn_phone.cucm_update_request_flg = '3'																																																								
																													  THEN '4'																																																								
																													  WHEN																																																								
																													    trn_phone.cucm_update_request_flg = '1'																																																								
																													  THEN '2'																																																								
																													  ELSE '3'																																																								
																													END AS statusCode																																																								
																													, CASE																																																								
																													  WHEN																																																								
																													    trn_phone.cucm_update_request_flg = '2'																																																								
																													  WHEN																																																								
																													    trn_phone.cucm_update_request_flg = '3'																																																								
																													  THEN ''																																																								
																													  WHEN																																																								
																													    trn_phone.cucm_update_request_flg = '1'																																																								
																													  THEN '反映待'																																																								
																													  ELSE '反映済'																																																								
																													END AS status																																																								
																													, ⑨取得結果.transMask																																																								
																													, ⑨取得結果.gwRepletionSpecialNo																																																								
				⑨LINE情報																																																																																	
					テーブル名																							取得項目																																条件																									
					trn_line																							trn_line.line_id,																																trn_line.delete_flg = '0'																									
					INNER JOIN rel_cucm_phone_line																							trn_line.call_pickup_group_nm,																																																									
					  ON trn_line.line_id																							trn_line.directory_no,																																																									
					    = rel_cucm_phone_line.line_id																							trn_line.fwd_busy_destination,																																																									
					  AND rel_cucm_phone_line.delete_flg = '0'																							trn_line.fwd_noans_destination,																																																									
					INNER JOIN trn_charge_association																							mst_branch.branch_cd,																																																									
					  ON trn_line.line_id																							mst_section.parent_section_cd,																																																									
					    = trn_charge_association.line_id																							mst_section.section_cd,																																																									
					INNER JOIN trn_phone																							trn_line.external_phone_number_mask,																																																									
					  ON rel_cucm_phone_line.phone_id																							trn_line.line_text_label,																																																									
					    = trn_phone.phone_id																							rel_cucm_phone_line.phone_id AS cucmtelidinline,																																																									
					INNER JOIN mst_section																							trn_line.dialin,																																																									
					  ON trn_charge_association.section_id																							rel_cucm_phone_line.no AS lineIndex,																																																									
					    = mst_section.section_id																							mst_cucm_voice_mail_profile.voice_mail_profile_nm AS voiceMailProfileName,																																																									
					INNER JOIN mst_branch																							rel_cucm_phone_line.remarks AS telLineRemarks,																																																									
					  ON trn_charge_association.branch_id																							trn_phone.remarks AS telRemarks,																																																									
					    = mst_branch.branch_id																							trn_charge_association.remarks AS chargeRemarks,																																																									
					INNER JOIN mst_cucm_voice_mail_profile																							trn_line.ring_setting_nm AS ringSettingName,																																																									
					  ON mst_cucm_voice_mail_profile.voice_mail_profile_id																							trn_line.calling_party_transformation_mask AS transMask																																																									
					    = trn_line.voice_mail_profile_id																							ttrn_line.gw_repletion_special_no AS gwRepletionSpecialNo																																																									
																																																																																					
				⑩ユーザー情報																																																																																	
					テーブル名																		取得項目																																条件																														
					rel_cucm_user_phone																		trn_user.user_id																																trn_user.delete_flg = '0'																														
					INNER JOIN trn_user																		, trn_user.user_nm_kanji																																																														
					  ON rel_cucm_user_phone.user_id																		, trn_user.user_nm_kana																																																														
					    = trn_user.user_id																		, trn_user.enabled_shared_use																																																														
					  AND elr_cucm_user_phone.delete_flg = '0'																		, rel_user_section.company_id																																																														
					INNER JOIN rel_user_section																		, rel_user_section.section_id																																																														
					  ON trn_user.user_id																		, rel_user_section.section_name																																																														
					    = rel_user_section.user_id																		, rel_user_section.print_order																																																														
					  AND rel_cucm_user_phone.section_id																		, rel_cucm_user_phone.phone_id																																																														
					    = rel_user_section.section_id																		, t_section_child.print_order																																																														
					  AND rel_user_section.delete_flg = '0'																		, t_section_child.section_nm																																																														
					INNER JOIN mst_section t_section_child																		, t_section_parent.print_order																																																														
					  ON rel_user_section.section_id																																																																																
					    = t_section_child.section_id																																																																																
					  AND rel_user_section.company_id																																																																																
					    = t_section_child.company_id																																																																																
					INNER JOIN mst_section t_section_parent																																																																																
					  ON t_section_child.parent_section_id																																																																																
					    = t_section_parent.section_id																																																																																
																																																																																					
				⑪電話機と紐付いていないユーザー情報																																																																																	
					テーブル名																		取得項目																																条件																														
					⑫取得結果																		NULL AS lineId																																無し																														
					EXCEPT																		, NULL AS lineIndex																																																														
					⑬取得結果																		, NULL AS pickupGroupName																																																														
																							, NULL AS directoryNumber																																																														
																							, NULL AS busyDestination																																																														
																							, NULL AS noansDestination																																																														
																							, NULL AS loggerData																																																														
																							, NULL AS chargeAssociationBranchId																																																														
																							, NULL AS chargeAssociationParentSectionId																																																														
																							, NULL AS chargeAssociationSectionId																																																														
																							, NULL AS lineTextLabel																																																														
																							, NULL AS externalPhoneNumberMask																																																														
																							, NULL AS dialinNumber																																																														
																							, NULL AS telDirData																																																														
																							, userId																																																														
																							, kanjiUserName																																																														
																							, kanaUserName																																																														
																							, companyId																																																														
																							, sectionId																																																														
																							, userSectionparentPrintorder																																																														
																							, userSectionchildPrintorder																																																														
																							, userSectionPrintorder																																																														
																							, NULL AS userBranchAll																																																														
																							, NULL AS userBranch																																																														
																							, sectionName																																																														
																							, enabledSharedUse  AS sharedUse																																																														
																							, NULL AS telId																																																														
																							, NULL AS telTypeModel																																																														
																							, NULL AS telType																																																														
																							, NULL AS macAddress																																																														
																							, NULL AS callingSearchSpaceName																																																														
																							, NULL AS baseLocation																																																														
																							, NULL AS baseDp																																																														
																							, NULL AS branchTelId																																																														
																							, NULL AS companyTelId																																																														
																							, NULL AS sectionTelId																																																														
																							, NULL AS phoneButtonTemplete																																																														
																							, NULL AS branchTelName																																																														
																							, NULL AS sectionTelName																																																														
																							, NULL AS phoneSectionParentPrintorder																																																														
																							, NULL AS phoneSectionChildPrintorder																																																														
																							, substring(sectionName,																																																														
																							  length(childSectionName) + 1) AS searchSectionName																																																														
																							, organization_cd AS orgId																																																														
																							, NULL AS clusterId																																																														
																							, NULL AS voiceMailProfileName																																																														
																							, NULL AS telLineRemarks																																																														
																							, NULL AS telRemarks																																																														
																							, NULL AS chargeRemarks																																																														
																							, NULL AS addonModuleName1																																																														
																							, NULL AS addonModuleName2																																																														
																							, NULL AS ringSettingName																																																														
																							, NULL AS pickupGroupNo																																																														
																							, NULL AS loggerDataName																																																														
																							, CASE																																																														
																							  WHEN userUpdateRequest = '2' THEN '2'																																																														
																							  WHEN userErrorFlg      = '1' THEN '1'																																																														
																							  WHEN userUpdateRequest = '3' THEN '4'																																																														
																							  WHEN userUpdateRequest = '1' THEN '2'																																																														
																							  ELSE '3'																																																														
																							END AS statusCode																																																														
																							, CASE																																																														
																							  WHEN userUpdateRequest = '2' THEN '反映待'																																																														
																							  WHEN userErrorFlg      = '1' THEN 'エラー'																																																														
																							  WHEN userUpdateRequest = '3' THEN ''																																																														
																							  WHEN userUpdateRequest = '1' THEN '反映待'																																																														
																							  ELSE '反映済'																																																														
																							END AS status																																																														
																							NULL AS transMask																																																														
																							NULL AS gwRepletionSpecialNo		


				⑫ユーザー関連情報																																																																																	
					テーブル名																		取得項目																																条件																														
					trn_user																		trn_user.user_id																																trn_user.delete_flg = '0'																														
					INNER JOIN rel_user_section																		, trn_user.user_nm_kanji																																																														
					  ON  trn_user.user_id																		, trn_user.user_nm_kana																																																														
					    = rel_user_section.user_id																		, rel_user_section.company_id																																																														
					  AND rel_user_section.delete_flg = '0'																		, rel_user_section.section_id																																																														
					INNER JOIN mst_section t_section_child																		, rel_user_section.section_nm																																																														
					  ON  rel_user_section.company_id																		, rel_user_section.print_order																																																														
					    = t_section_child.company_id																		, trn_user.enabled_shared_use																																																														
					  AND rel_user_section.section_id																		, t_section_parent.print_order																																																														
					    = t_section_child.section_id																		, t_section_child.print_order																																																														
					INNER JOIN mst_section t_section_parent																		, t_section_child.section_nm																																																														
					  ON t_section_child.parent_section_id																		, t_section_child.organization_cd																																																														
					    = t_section_parent.section_id																																																																																
																																																																																					
				⑬ユーザー電話機関連情報																																																																																	
					テーブル名																		取得項目																																条件																														
					rel_cucm_user_phone																		trn_user.user_id																																無し																														
					INNER JOIN trn_phone																		, trn_user.user_nm_kanji																																																														
					  ON  rel_cucm_user_phone.phone_id																		, trn_user.user_nm_kana																																																														
					    = trn_phone.phone_id																		, rel_user_section.company_id																																																														
					  AND rel_cucm_user_phone.delete_flg = '0'																		, rel_user_section.section_id																																																														
					INNER JOIN trn_user																		, rel_user_section.section_nme																																																														
					  ON  rel_cucm_user_phone.user_id																		, rel_user_section.print_order																																																														
					    = trn_user.user_id																		, trn_user.enabled_shared_use																																																														
					  AND trn_user.delete_flg = '0'																		, t_section_parent.print_order																																																														
					INNER JOIN rel_user_section																		, t_section_child.print_order																																																														
					  ON  rel_cucm_user_phone.user_id																		, t_section_child.section_nm																																																														
					    = rel_user_section.user_id																		, t_section_child.organization_cd																																																														
					  AND rel_cucm_user_phone.company_id																																																																																
					    = rel_user_section.company_id																																																																																
					  AND rel_cucm_user_phone.section_id																																																																																
					    = rel_user_section.section_id																																																																																
					  AND rel_user_section.delete_flg = '0'																																																																																
					INNER JOIN mst_section t_section_child																																																																																
					  ON  rel_user_section.company_id																																																																																
					    = t_section_child.company_id																																																																																
					  AND rel_user_section.section_id																																																																																
					    = t_section_child.section_id																																																																																
					INNER JOIN mst_section t_section_parent																																																																																
					  ON t_section_child.parent_section_id																																																																																
					    = t_section_parent.section_id																																																																																
																																																																																					
				2.CSVファイル出力																																																																																	
					①データを設定する																																																																																
						取得したデータをMapに保持する																																																																															
																																																																																					
					②ヘッダを設定する																																																																																
						ア.変数Aを配列に格納する																																																																															
							▼配列が空の場合																																																																														
								・以下のメッセージIDでログを出力する																																																																													
									メッセージID：BT_000_E003													パラメータ：定義名																																																															
								・CSVExceptionを発生させる																																																																													
																																																																																					
						イ.ヘッダをListに保持する																																																																															
																																																																																					
					③CSVファイル名を設定する																																																																																
						ア.変数C、変数Dを結合する																																																																															
																																																																																					
						イ.変数Bに「_YYYYMMDDHH24MISS」を付与する																																																																															
																																																																																					
						ウ.アとイを結合し保持する																																																																															
																																																																																					
					④出力先ディレクトリ準備																																																																																
						ア.設定.CsvExportDirが存在するか確認する																																																																															
							▼存在しない場合																																																																														
								・出力先ディレクトリを作成する																																																																													
																																																																																					
					⑤CSVファイルを出力する																																																																																
						ア.ヘッダとデータをCSVフォーマットで結合する																																																																															
																																																																																					
						イ.③で設定したCSVファイルを作成する																																																																															
																																																																																					
						ウ.アのデータを書き込む																																																																															
																																																																																					
				3.処理終了ログ出力																																																																																	
					以下のメッセージIDでログを出力する																																																																																
						メッセージID：BT_000_I006													パラメータ：「$1」を出力しました。（データ件数：$2）																																																																		
																								$1:CSVファイル名、$2:データ件数																																																													
		■例外処理																																																																																			
			1.エラーファイル作成																																																																																		
				エラーファイルを作成する																																																																																	
																																																																																					
		■終了処理																																																																																			
			1.ロックファイル削除																																																																																		
				[バッチ詳細設計共通].アンロック処理を呼出し、バッチ処理の終了とする																																																																																	
																																																																																					
			2.終了ログを出力する																																																																																		
				メッセージID：BT_003_I002																																																										